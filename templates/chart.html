<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mood Chart â€“ Happy Harbour</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ˆ Your Mood Journey</h1>
    <canvas id="moodChart" width="400" height="200"></canvas>
    <br>
    <a href="/">ğŸ  Back to Home</a> | 
    <a href="/history">ğŸ“œ Mood History</a>
  </div>

  <script>
    async function loadChart() {
      const response = await fetch('/chart-data');
      const data = await response.json();

      const sentimentColors = {
        "Positive": "#28a745",
        "Neutral": "#6c757d",
        "Negative": "#dc3545"
      };

      const backgroundColors = data.sentiments.map(s => sentimentColors[s] || '#999');

      new Chart(document.getElementById('moodChart'), {
        type: 'bar',
        data: {
          labels: data.labels,
          datasets: [{
            label: 'Mood Sentiment',
            data: data.sentiments.map(s => {
              if (s === "Positive") return 3;
              if (s === "Neutral") return 2;
              if (s === "Negative") return 1;
              return 0;
            }),
            backgroundColor: backgroundColors,
          }]
        },
        options: {
          scales: {
            y: {
              ticks: {
                stepSize: 1,
                callback: function(value) {
                  if (value === 1) return "Negative";
                  if (value === 2) return "Neutral";
                  if (value === 3) return "Positive";
                  return "";
                }
              },
              beginAtZero: true,
              max: 3.5
            }
          }
        }
      });
    }

    loadChart();
  </script>
</body>
</html>
